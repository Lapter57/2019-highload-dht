#Этап 7. Результаты нагрузочного тестирования

## Лента `PUT`-ов с уникальными ключами
### [Линейная нагрузка](https://overload.yandex.net/229565)
С помощью написанного генератора патронов была создана лента,
состоящая из 1500000 патронов, поскольку стрельба происходила 
до 10000 _rps_ в течение 5 минут. 

При линейной нагрузке сервер стабильно отвечал до 8300 _rps_, после чего
количество воркеров выросло до 1000 и в дальнейшем не уменьшалось.

### [Линейная и постоянная нагрузки](https://overload.yandex.net/229575)
Поскольку точка разладки получилась равной 8300 _rps_, то нагрузка была
уменьшена на 30%. Поэтому сначала нагрузка линейно возрастала до 6000 _rps_
в течение 1 минуты, после чего нагрузка была постоянна в течение 4 минут.

В результате:

* Во время линейной нагрузки значения на 98 перцентилях
не превышали 50 мс. При постоянной нагрузке это же значение уже колебалось
от 50 мс до 180 мс. 
* Все ответы, которые приходили от сервера, были положительные, но на 
постоянной нагрузке были небольшие проседания.
* Согласно графику распределению времени ответов большая их часть была
получена за 12-42 мс, а так же заметное число ответов дошло за менее чем
1 мс. Скорее всего на бимодальность распределения данных повлияла очередь
сброса данных на диск, которая переполнялась при большой нагрузке.
* Количество воркеров постоянно менялось. Иногда оно достигало 1000.

Можно сделать вывод, что сервер выдерживает данную нагрузку, но лучше
предельное значение понизить, например, до 5000 _rps_.

## Лента `PUT`-ов с частичной перезаписью (вероятность 10 %)

### [Линейная нагрузка](https://overload.yandex.net/229812)
С помощью написанного генератора патронов была создана лента,
состоящая из 1500000 патронов, среди которых можно было встретить
повторы. Стрельба происходила до 10000 _rps_ в течение 5 минут. 

Ситуация оказалась аналогична первой: при линейной нагрузке сервер 
стабильно отвечал до 8300 _rps_, после чего количество воркеров 
выросло до 1000 и в дальнейшем не уменьшалось.

### [Линейная и постоянная нагрузки](https://overload.yandex.net/229819)
Поскольку точка разладки получилась равной 8300 _rps_, то нагрузка была
уменьшена на 30%. Поэтому сначала нагрузка линейно возрастала до 6000 _rps_
в течение 1 минуты, после чего нагрузка была постоянна в течение 4 минут.

В результате по сравнению с запросами `PUT`-ов с уникальными ключами
заметны следующие улучшения:

* Значение 98 перцентили сильно возрастало только 2 раза до 150 мс, а
в основном оно не превышало 50 мс. 
* Количество положительных ответов выросло, и на постоянной нагрузке
проседаний стало заметно меньше.
* Распределение времени ответов осталось мультимодальным, но значительно
увеличилось число ответов, которые были получены менее чем за 1 мс. 
* Количество воркеров сильно не варьировалось и в основном было равно 250.

Можно сделать вывод, что сервер успешно выдержал данную нагрузку.

## Лента `GET`-ов существующих ключей с равномерным распределением

### [Линейная нагрузка](https://overload.yandex.net/230003)
С помощью написанного генератора патронов была создана лента,
состоящая из 1500000 патронов. Первоначально хранилище было обстрелено
патронами `PUT`-ов с уникальными ключами. Эти же ключи использовались
при генерации данной ленты. Стрельба происходила до 10000 _rps_ 
в течение 5 минут. 

При линейной нагрузке сервер стабильно отвечал до 1300 _rps_, 
после чего количество воркеров выросло до 1000 и в дальнейшем 
не уменьшалось.

### [Линейная и постоянная нагрузки](https://overload.yandex.net/230103)
Поскольку точка разладки получилась равной 1300 _rps_, то нагрузка была
уменьшена на 30%. Поэтому сначала нагрузка линейно возрастала до 1000 _rps_
в течение 1 минуты, после чего нагрузка была постоянна в течение 4 минут.

В результате:

* Значение 98 перцентили в основном не превышало 100 мс.  
* Были получены только положительные ответы. Проседания были, но их немного,
и они не большие.
* Распределение времени ответов мультимодально, большинство запросов
приходило либо менее чем за 2 мс либо за 10-30 мс. В данном случае
два пика в распределении, наверное, как-то связаны с работой
GC, что приводило к задержке ответов.
* Количество воркеров в целом было меньше 100.

Можно сделать вывод, что сервер успешно выдержал данную нагрузку.

## Лента `GET`-ов существующих ключей со смещенным распределением к недавно добавленным ключам

### [Линейная нагрузка](https://overload.yandex.net/230016)
С помощью написанного генератора патронов была создана лента,
состоящая из 1500000 патронов. Первоначально хранилище было обстрелено
патронами `PUT`-ов с уникальными ключами. Эти же ключи использовались
при генерации данной ленты, но в отличие от прошлой стрельбы они в основном состояли из ключей, которые были записаны в хранилище
последними. Стрельба происходила до 10000 _rps_ в течение 5 минут. 

При линейной нагрузке сервер стабильно отвечал до 1400 _rps_, что
на 100 rps больше прошлого обстрела. После преодоления этой отметки 
количество воркеров выросло до 1000 и в дальнейшем не уменьшалось.

### [Линейная и постоянная нагрузки](https://overload.yandex.net/230021)
Поскольку точка разладки получилась равной 1400 _rps_, то нагрузка была
уменьшена на 30%. Поэтому сначала нагрузка линейно возрастала до 1100 _rps_
в течение 1 минуты, после чего нагрузка была постоянна в течение 4 минут.

В основном результаты схожи со стрельбой `GET`-ами с равномерным распределением
ключей.

## Лента со смешанной нагрузкой, состоящая из с 50% `PUT`-ов новых ключей и из 50% `GET`-ов существующих ключей (равномерное распределение)

### [Линейная нагрузка](https://overload.yandex.net/229836)
С помощью написанного генератора патронов была создана лента,
состоящая из 1500000 патронов. Первоначально хранилище было обстрелено
патронами `PUT`-ов с уникальными ключами. Эти же ключи использовались
при генерации `GET` патронов данной ленты. Стрельба происходила до 
10000 _rps_ в течение 5 минут. 

При линейной нагрузке сервер стабильно отвечал до 2100 _rps_, 
после чего количество воркеров выросло до 1000 и в дальнейшем 
не уменьшалось.

### [Линейная и постоянная нагрузки](https://overload.yandex.net/230055)
Поскольку точка разладки получилась равной 2100 _rps_, то нагрузка была
уменьшена на 30%. Поэтому сначала нагрузка линейно возрастала до 1500 _rps_
в течение 1 минуты, после чего нагрузка была постоянна в течение 4 минут.

В результате:

* Значение 98 перцентили в основном не превышало 100 мс.  
* Были получены только положительные ответы с небольшими проседаниями.
* На графике _Responses count per tag distribution_ видно, что
в общем количестве ответов состояло из 50% ответов на `PUT` запросы
и 50% ответов на `GET` запросы.
* Согласно графикам распределения времени ответов большинство ответов на
`GET` запросы приходили в течение 13 мс, а ответы на `PUT` запросы 
приходили менее чем за 1 мс. В обоих распределениях можно наблюдать два
пика.
* Количество воркеров в целом было меньше 150.

Можно сделать вывод, что сервер успешно выдержал данную нагрузку.